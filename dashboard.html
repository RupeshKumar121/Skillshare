<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillSwap | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    <style>body{font-family:'Inter',sans-serif}.brand-font{font-family:'Space Grotesk',sans-serif}</style>
</head>
<body class="bg-slate-950 text-white h-screen flex overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-64 bg-slate-900 border-r border-white/5 flex-col hidden md:flex">
        <div class="p-6">
            <div class="flex items-center gap-2 mb-8 text-2xl font-bold brand-font">
                <i class="fa-solid fa-bolt text-green-500"></i> SkillSwap
            </div>
            
            <nav class="space-y-2">
                <a href="dashboard.html" class="flex items-center gap-3 px-4 py-3 bg-green-500/10 text-green-400 rounded-xl font-bold border-l-4 border-green-500">
                    <i class="fa-solid fa-grid-2"></i> Dashboard
                </a>
                <a href="marketplace.html" class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:bg-white/5 hover:text-white rounded-xl transition-all">
                    <i class="fa-solid fa-store"></i> Marketplace
                </a>
            </nav>
        </div>
        <div class="mt-auto p-6">
            <button id="logout-btn" class="flex items-center gap-3 text-slate-500 hover:text-white transition-colors text-sm font-medium">
                <i class="fa-solid fa-right-from-bracket"></i> Sign Out
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-6 lg:p-10 relative">
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-2xl font-bold">Hello, <span id="user-name">Student</span> ðŸ‘‹</h1>
                <p class="text-slate-400">Track your learning journey.</p>
            </div>
            <div class="bg-slate-900 px-4 py-2 rounded-lg border border-slate-800">
                Wallet: <span id="coin-header" class="font-bold text-green-400">...</span> SC
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <!-- Wallet Card -->
            <div class="lg:col-span-3 relative overflow-hidden rounded-2xl p-8 border border-green-500/30 bg-gradient-to-br from-slate-900 to-slate-800">
                <div class="absolute right-0 top-0 w-64 h-64 bg-green-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center text-green-400">
                            <i class="fa-solid fa-wallet"></i>
                        </div>
                        <span class="text-green-400 font-mono text-sm tracking-wider font-bold">SKILLSCORE WALLET</span>
                    </div>
                    <h3 class="text-5xl font-bold text-white mb-2" id="coin-main">...</h3>
                    <p class="text-slate-400 text-sm mb-6">Earn more coins by offering sessions to peers.</p>
                    <div class="flex gap-3">
                        <a href="marketplace.html" class="px-5 py-2.5 bg-green-500 hover:bg-green-400 text-slate-900 font-bold rounded-lg text-sm transition-colors">
                            Spend Coins
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skills Section -->
        <div class="bg-slate-900/50 border border-white/5 rounded-2xl p-8">
            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                <i class="fa-solid fa-briefcase text-slate-400"></i> My Offered Skills
            </h3>
            <p class="text-slate-400 text-sm mb-6 max-w-2xl">
                Add skills you are confident in teaching. You will appear in the Marketplace and earn <span class="text-green-400 font-bold">50 SC/hr</span> when booked.
            </p>

            <form id="add-skill-form" class="flex gap-4 mb-6 max-w-lg">
                <input type="text" id="skill-input" class="flex-1 bg-slate-950 border border-slate-700 rounded-xl px-4 py-3 text-white focus:border-green-500 outline-none transition-all" placeholder="E.g. Python, Finance, Case Prep...">
                <button type="submit" class="bg-slate-700 hover:bg-green-500 hover:text-slate-900 text-white font-bold px-6 py-3 rounded-xl transition-all">
                    Add
                </button>
            </form>

            <div id="skills-list" class="flex flex-wrap gap-3">
                <div class="text-slate-500 italic text-sm py-2">Loading skills...</div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ============================================================
        // PASTE YOUR FIREBASE CONFIG HERE
        // ============================================================
        const firebaseConfig = {
  apiKey: "AIzaSyA9Jk0jXfYc5ac61tPAqAEiT3uOscmC52s",
  authDomain: "skillswap-b23e4.firebaseapp.com",
  projectId: "skillswap-b23e4",
  storageBucket: "skillswap-b23e4.firebasestorage.app",
  messagingSenderId: "470726238704",
  appId: "1:470726238704:web:53608bc2e3d1c7fe793d35",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUserUid = null;

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUserUid = user.uid;
                loadUserData(user.uid);
            } else {
                window.location.href = "auth.html";
            }
        });

        async function loadUserData(uid) {
            try {
                const docRef = doc(db, "users", uid);
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('user-name').innerText = data.name || "Student";
                    document.getElementById('coin-header').innerText = data.coins || 0;
                    document.getElementById('coin-main').innerText = data.coins || 0;
                    renderSkills(data.skills || []);
                } else {
                    console.error("No user document found!");
                }
            } catch(e) {
                console.error("Error loading user data:", e);
            }
        }

        function renderSkills(skills) {
            const container = document.getElementById('skills-list');
            container.innerHTML = '';
            if (skills.length === 0) container.innerHTML = '<div class="text-slate-500 italic text-sm">No skills added yet.</div>';
            
            skills.forEach(skill => {
                const tag = document.createElement('div');
                tag.className = "bg-slate-800 border border-slate-700 px-3 py-1.5 rounded-lg flex items-center gap-2 text-sm";
                tag.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500"></span>${skill}<button class="ml-1 text-slate-500 hover:text-red-400 del-btn"><i class="fa-solid fa-xmark"></i></button>`;
                tag.querySelector('.del-btn').addEventListener('click', () => removeSkill(skill));
                container.appendChild(tag);
            });
        }

        async function removeSkill(skill) {
            if (!currentUserUid) return;
            await updateDoc(doc(db, "users", currentUserUid), { skills: arrayRemove(skill) });
            loadUserData(currentUserUid);
        }

        document.getElementById('add-skill-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const input = document.getElementById('skill-input');
            if(input.value.trim() && currentUserUid) {
                await updateDoc(doc(db, "users", currentUserUid), { skills: arrayUnion(input.value.trim()) });
                input.value = '';
                loadUserData(currentUserUid);
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));
    </script>
</body>
</html>
