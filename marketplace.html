<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SkillSwap | Marketplace</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
        />
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Space+Grotesk:wght@500;700&display=swap");
            body {
                font-family: "Inter", sans-serif;
            }
            .glass-panel {
                background: rgba(30, 41, 59, 0.7);
                backdrop-filter: blur(12px);
                border: 1px solid rgba(255, 255, 255, 0.08);
            }
        </style>
    </head>
    <body class="bg-slate-950 text-white h-screen flex overflow-hidden">
        <aside
            class="w-64 bg-slate-900 border-r border-white/5 flex-col hidden md:flex"
        >
            <div class="p-6 border-b border-white/5 flex items-center gap-2">
                <i class="fa-solid fa-bolt text-green-500 text-2xl"></i>
                <span class="text-xl font-bold font-mono">SkillSwap</span>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a
                    href="dashboard.html"
                    class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:bg-white/5 rounded-lg"
                    ><i class="fa-solid fa-grid-2"></i> Dashboard</a
                >
                <a
                    href="marketplace.html"
                    class="flex items-center gap-3 px-4 py-3 bg-white/5 text-green-400 rounded-lg border-l-4 border-green-500"
                    ><i class="fa-solid fa-store"></i> Marketplace</a
                >
            </nav>
        </aside>

        <main class="flex-1 flex flex-col overflow-hidden">
            <header
                class="h-16 border-b border-white/5 bg-slate-900/50 backdrop-blur-md flex items-center justify-between px-6"
            >
                <h2 class="text-lg font-bold">Marketplace</h2>
                <div
                    class="bg-slate-800 px-4 py-2 rounded-lg text-sm border border-slate-700"
                >
                    Wallet:
                    <span id="wallet-balance" class="font-bold text-green-400"
                        >...</span
                    >
                    SC
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-8">
                <div class="mb-8">
                    <div class="relative max-w-2xl mx-auto mb-6">
                        <i
                            class="fa-solid fa-search absolute left-4 top-4 text-slate-500"
                        ></i>
                        <input
                            type="text"
                            id="search-bar"
                            onkeyup="filterMentors()"
                            class="w-full bg-slate-900 border border-slate-700 rounded-2xl pl-12 pr-4 py-3.5 text-white focus:border-green-500 outline-none shadow-lg"
                            placeholder="Search by Skill (e.g. Finance, Python, Resume)..."
                        />
                    </div>
                    <div
                        class="flex flex-wrap justify-center gap-2"
                        id="filter-tags"
                    >
                        <button
                            onclick="setFilter('All')"
                            class="px-4 py-1.5 rounded-full bg-green-500 text-black font-bold text-sm"
                        >
                            All
                        </button>
                        <button
                            onclick="setFilter('Finance')"
                            class="px-4 py-1.5 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-600 text-sm"
                        >
                            Finance
                        </button>
                        <button
                            onclick="setFilter('Python')"
                            class="px-4 py-1.5 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-600 text-sm"
                        >
                            Python
                        </button>
                        <button
                            onclick="setFilter('Marketing')"
                            class="px-4 py-1.5 rounded-full bg-slate-800 hover:bg-slate-700 border border-slate-600 text-sm"
                        >
                            Marketing
                        </button>
                    </div>
                </div>

                <div
                    id="mentors-grid"
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
                ></div>
            </div>
        </main>

        <script>
            // 1. Get User Data
            let user = JSON.parse(localStorage.getItem("skillSwap_user")) || {
                name: "Arjun",
                coins: 145,
            };
            document.getElementById("wallet-balance").innerText = user.coins;

            // 2. Dummy Data (The Marketplace Database)
            const dbMentors = [
                {
                    id: 1,
                    name: "Raghav (PGP2)",
                    role: "Senior Mentor",
                    skills: ["Marketing", "Resume Review", "Strategy"],
                    cost: 60,
                    rating: 4.9,
                },
                {
                    id: 2,
                    name: "Neha (IPM2)",
                    role: "Tech Lead",
                    skills: ["Python", "Web Dev", "Excel"],
                    cost: 40,
                    rating: 4.8,
                },
                {
                    id: 3,
                    name: "Suresh (PGP1)",
                    role: "Fin Club",
                    skills: ["Finance", "Valuation", "Accounting"],
                    cost: 50,
                    rating: 4.6,
                },
                {
                    id: 4,
                    name: "Priya (IPM3)",
                    role: "Debate Soc",
                    skills: ["Public Speaking", "English", "Interview Prep"],
                    cost: 45,
                    rating: 4.7,
                },
                {
                    id: 5,
                    name: "Amit (PGP2)",
                    role: "Consulting",
                    skills: ["Case Prep", "Guesstimates", "Resume Review"],
                    cost: 70,
                    rating: 5.0,
                },
            ];

            // 3. Render Function
            function renderMentors(filter = "") {
                const grid = document.getElementById("mentors-grid");
                grid.innerHTML = "";

                const filtered = dbMentors.filter((m) => {
                    const searchStr = filter.toLowerCase();
                    // Check name or any skill matches
                    return (
                        m.name.toLowerCase().includes(searchStr) ||
                        m.skills.some((s) =>
                            s.toLowerCase().includes(searchStr),
                        )
                    );
                });

                if (filtered.length === 0) {
                    grid.innerHTML = `<div class="col-span-3 text-center text-slate-500 py-10">No mentors found for "${filter}"</div>`;
                    return;
                }

                filtered.forEach((m) => {
                    const card = document.createElement("div");
                    card.className =
                        "glass-panel p-6 rounded-2xl hover:border-green-500/50 transition-all group";
                    card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex gap-3">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-blue-500"></div>
                            <div>
                                <h3 class="font-bold text-lg leading-tight">${m.name}</h3>
                                <p class="text-xs text-slate-400">${m.role}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-1 text-yellow-400 text-xs font-bold bg-yellow-400/10 px-2 py-1 rounded">
                            <i class="fa-solid fa-star"></i> ${m.rating}
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 mb-6">
                        ${m.skills.map((s) => `<span class="text-xs px-2 py-1 rounded bg-slate-800 text-slate-300 border border-slate-700">${s}</span>`).join("")}
                    </div>
                    <div class="flex items-center justify-between pt-4 border-t border-white/5">
                        <div class="text-white font-bold">${m.cost} <span class="text-green-400 text-xs">SC/hr</span></div>
                        <button onclick="bookSession(${m.id}, ${m.cost}, '${m.name}')" class="bg-white text-slate-900 px-4 py-2 rounded-lg text-sm font-bold hover:bg-green-400 transition-colors">Book Now</button>
                    </div>
                `;
                    grid.appendChild(card);
                });
            }

            // 4. Booking Logic (Transaction)
            function bookSession(id, cost, mentorName) {
                if (user.coins >= cost) {
                    if (
                        confirm(
                            `Book session with ${mentorName} for ${cost} SkillCoins?`,
                        )
                    ) {
                        // Deduct coins
                        user.coins -= cost;
                        // Update Database
                        localStorage.setItem(
                            "skillSwap_user",
                            JSON.stringify(user),
                        );
                        // Update UI
                        document.getElementById("wallet-balance").innerText =
                            user.coins;
                        // Success Message
                        alert(
                            `Success! Session confirmed with ${mentorName}. Check your email for the link.`,
                        );
                    }
                } else {
                    alert(
                        `Insufficient Balance! You need ${cost} coins but only have ${user.coins}. Offer help to earn more!`,
                    );
                }
            }

            // 5. Search/Filter Helpers
            function filterMentors() {
                const input = document.getElementById("search-bar").value;
                renderMentors(input);
            }

            function setFilter(tag) {
                const input = document.getElementById("search-bar");
                input.value = tag === "All" ? "" : tag;
                renderMentors(tag === "All" ? "" : tag);
            }

            // Initial Load
            renderMentors();
        </script>
    </body>
</html>
